<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNO-Oracle - Gesti√≥n de Datos</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üóÑÔ∏è</text></svg>">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üóÑÔ∏è DNO-Oracle</h1>
                <p>Sistema de Gesti√≥n de Datos Oracle</p>
            </div>
            <div class="header-controls">
                <!-- Connection Selector -->
                <div class="connection-selector">
                    <label for="connection-select">üîó Conexi√≥n:</label>
                    <select id="connection-select" class="connection-dropdown">
                        <option value="">Cargando...</option>
                    </select>
                    <button id="refresh-connections-btn" class="btn btn-sm btn-outline" title="Actualizar conexiones">
                        üîÑ
                    </button>
                </div>
            </div>
            <div class="header-actions">
                <button id="health-check-btn" class="btn btn-outline">
                    <span class="btn-icon">üíö</span>
                    Health Check
                </button>
                <button id="api-info-btn" class="btn btn-outline">
                    <span class="btn-icon">üìã</span>
                    API Info
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-tab="import">
                <span class="nav-icon">üì§</span>
                Importar Archivos
            </button>
            <button class="nav-btn" data-tab="tables">
                <span class="nav-icon">üóÇÔ∏è</span>
                Gestionar Tablas
            </button>
            <button class="nav-btn" data-tab="entities">
                <span class="nav-icon">üèóÔ∏è</span>
                Entidades
            </button>
            <button class="nav-btn" data-tab="queries">
                <span class="nav-icon">üîç</span>
                Consultas SQL
            </button>
            <button class="nav-btn" data-tab="procedures">
                <span class="nav-icon">‚öôÔ∏è</span>
                Procedimientos
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- Import Tab -->
            <div id="import-tab" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <h2>üì§ Importar Archivo CSV</h2>
                        <p>Selecciona un archivo CSV para importar a una tabla Oracle</p>
                    </div>
                    <div class="card-body">
                        <!-- File Upload -->
                        <div class="upload-section">
                            <div class="upload-area" id="upload-area">
                                <div class="upload-icon">üìÅ</div>
                                <div class="upload-text">
                                    <h3>Arrastra tu archivo CSV aqu√≠</h3>
                                    <p>o haz clic para seleccionar</p>
                                </div>
                                <input type="file" id="file-input" accept=".csv" style="display: none;">
                            </div>
                            <div class="file-info" id="file-info" style="display: none;">
                                <div class="file-details">
                                    <span class="file-name"></span>
                                    <span class="file-size"></span>
                                </div>
                                <button class="btn btn-sm btn-outline" id="remove-file-btn">‚ùå Quitar</button>
                            </div>
                        </div>

                        <!-- Configuration -->
                        <div class="config-section" id="config-section" style="display: none;">
                            <h3>‚öôÔ∏è Configuraci√≥n de Importaci√≥n</h3>
                            
                            <div class="form-group">
                                <label for="table-select">Tabla de destino:</label>
                                <select id="table-select" class="form-control">
                                    <option value="">Selecciona una tabla...</option>
                                </select>
                            </div>

                            <div class="form-options">
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" id="skip-first-row" checked>
                                        Omitir primera fila (headers)
                                    </label>
                                </div>
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" id="validate-only">
                                        Solo validar (no importar)
                                    </label>
                                </div>
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" id="truncate-table">
                                        Vaciar tabla antes de importar
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="batch-size">Tama√±o de lote:</label>
                                <input type="number" id="batch-size" class="form-control" value="1000" min="1" max="10000">
                            </div>
                        </div>

                        <!-- Column Mapping -->
                        <div class="mapping-section" id="mapping-section" style="display: none;">
                            <h3>üîó Mapeo de Columnas</h3>
                            <div class="mapping-container" id="mapping-container">
                                <!-- Mappings will be populated here -->
                            </div>
                            <button class="btn btn-outline" id="auto-map-btn">
                                <span class="btn-icon">ü§ñ</span>
                                Mapeo Autom√°tico
                            </button>
                        </div>

                        <!-- Actions -->
                        <div class="actions" id="import-actions" style="display: none;">
                            <button class="btn btn-primary" id="import-btn">
                                <span class="btn-icon">üöÄ</span>
                                Importar Datos
                            </button>
                            <button class="btn btn-outline" id="preview-btn">
                                <span class="btn-icon">üëÅÔ∏è</span>
                                Vista Previa
                            </button>
                            <button class="btn btn-outline" id="validate-btn">
                                <span class="btn-icon">‚úÖ</span>
                                Validar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div class="card" id="results-card" style="display: none;">
                    <div class="card-header">
                        <h2>üìä Resultados</h2>
                    </div>
                    <div class="card-body">
                        <div id="results-content"></div>
                    </div>
                </div>
            </div>

            <!-- Tables Tab -->
            <div id="tables-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>üóÇÔ∏è Gesti√≥n de Tablas</h2>
                        <div class="card-actions">
                            <button class="btn btn-outline" id="refresh-tables-btn">
                                <span class="btn-icon">üîÑ</span>
                                Actualizar
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="search-section">
                            <div class="search-container">
                                <input type="text" id="table-search" class="search-input" placeholder="üîç Buscar tabla...">
                            </div>
                        </div>
                        <div class="tables-grid" id="tables-grid">
                            <!-- Tables will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Table Details Section -->
                <div class="card" id="table-details-card" style="display: none;">
                    <div class="card-header">
                        <h2 id="table-details-title">üìä Detalles de Tabla</h2>
                        <div class="card-actions">
                            <button class="btn btn-outline" id="close-table-details-btn">
                                <span class="btn-icon">‚ùå</span>
                                Cerrar
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-details-content" id="table-details-content">
                            <!-- Table details will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Entities Tab -->
            <div id="entities-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>üèóÔ∏è Gesti√≥n de Entidades</h2>
                        <div class="card-actions">
                            <button class="btn btn-primary" id="create-entity-btn">
                                <span class="btn-icon">‚ûï</span>
                                Nueva Entidad
                            </button>
                            <button class="btn btn-secondary" id="generate-entity-btn">
                                <span class="btn-icon">üîß</span>
                                Generar desde Tabla
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="entities-container">
                            <!-- JSON Editor for new entity -->
                            <div class="entity-editor" id="entity-editor" style="display: none;">
                                <h3>üìù Editor de Entidad</h3>
                                <div class="form-group">
                                    <label for="entity-connection">Conexi√≥n:</label>
                                    <select id="entity-connection" class="form-control">
                                        <option value="default">Default</option>
                                        <option value="desa">Desarrollo</option>
                                        <option value="prod">Producci√≥n</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="entity-table-select">Tabla disponible:</label>
                                    <select id="entity-table-select" class="form-control">
                                        <option value="">Selecciona una tabla...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="entity-json">Configuraci√≥n JSON:</label>
                                    <textarea id="entity-json" class="form-control code-editor" rows="20" placeholder="Ingresa la configuraci√≥n JSON de la entidad..."></textarea>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-primary" id="save-entity-btn">
                                        <span class="btn-icon">üíæ</span>
                                        Guardar Entidad
                                    </button>
                                    <button class="btn btn-outline" id="cancel-entity-btn">
                                        <span class="btn-icon">‚ùå</span>
                                        Cancelar
                                    </button>
                                    <button class="btn btn-outline" id="validate-entity-btn">
                                        <span class="btn-icon">‚úÖ</span>
                                        Validar JSON
                                    </button>
                                </div>
                            </div>

                            <!-- Modal para generaci√≥n autom√°tica de entidades -->
                            <div class="entity-generator" id="entity-generator" style="display: none;">
                                <h3>üîß Generar Entidad desde Tabla</h3>
                                <p class="help-text">Selecciona una tabla f√≠sica para generar autom√°ticamente su entidad correspondiente.</p>
                                
                                <div class="form-group">
                                    <label for="generator-connection">Conexi√≥n:</label>
                                    <select id="generator-connection" class="form-control">
                                        <option value="default">Default</option>
                                        <option value="desa">Desarrollo</option>
                                        <option value="prod">Producci√≥n</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="generator-table-select">Tabla f√≠sica:</label>
                                    <select id="generator-table-select" class="form-control">
                                        <option value="">Cargando tablas...</option>
                                    </select>
                                    <button type="button" class="btn btn-sm btn-outline" id="refresh-generator-tables-btn" style="margin-top: 5px;">
                                        üîÑ Actualizar Tablas
                                    </button>
                                </div>
                                
                                <div class="form-group">
                                    <label for="generator-entity-name">Nombre de la entidad (opcional):</label>
                                    <input type="text" id="generator-entity-name" class="form-control" placeholder="Se usar√° el nombre de la tabla en min√∫sculas">
                                    <small class="help-text">Si se deja vac√≠o, se usar√° el nombre de la tabla convertido a min√∫sculas.</small>
                                </div>
                                
                                <div class="form-actions">
                                    <button class="btn btn-primary" id="generate-entity-action-btn">
                                        <span class="btn-icon">üîß</span>
                                        Generar Entidad
                                    </button>
                                    <button class="btn btn-outline" id="cancel-generator-btn">
                                        <span class="btn-icon">‚ùå</span>
                                        Cancelar
                                    </button>
                                    <button class="btn btn-secondary" id="preview-entity-btn" style="display: none;">
                                        <span class="btn-icon">üëÅÔ∏è</span>
                                        Ver Vista Previa
                                    </button>
                                </div>
                                
                                <!-- Vista previa de la entidad generada -->
                                <div class="entity-preview" id="entity-preview" style="display: none;">
                                    <h4>üëÅÔ∏è Vista Previa de la Entidad</h4>
                                    <div class="form-group">
                                        <label>JSON Generado:</label>
                                        <textarea id="entity-preview-json" class="form-control code-editor" rows="15" readonly></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button class="btn btn-primary" id="save-generated-entity-btn">
                                            <span class="btn-icon">üíæ</span>
                                            Guardar Entidad Generada
                                        </button>
                                        <button class="btn btn-outline" id="edit-generated-entity-btn">
                                            <span class="btn-icon">‚úèÔ∏è</span>
                                            Editar Manualmente
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Current entities display -->
                            <div class="entities-list" id="entities-list">
                                <h3>üìã Entidades Actuales</h3>
                                <div class="entities-grid" id="entities-grid">
                                    <!-- Entities will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Queries Tab -->
            <div id="queries-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>üîç Consultas SQL</h2>
                        <div class="connection-info" id="query-connection-info">
                            <span class="connection-badge">üîó Conexi√≥n: <span id="current-connection-display">-</span></span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="query-editor">
                            <textarea id="sql-editor" class="sql-textarea" placeholder="Escribe tu consulta SQL aqu√≠..."></textarea>
                        </div>
                        <div class="query-actions">
                            <button class="btn btn-primary" id="execute-query-btn">
                                <span class="btn-icon">‚ñ∂Ô∏è</span>
                                Ejecutar
                            </button>
                            <button class="btn btn-outline" id="explain-query-btn">
                                <span class="btn-icon">üìã</span>
                                Explicar
                            </button>
                            <button class="btn btn-outline" id="validate-query-btn">
                                <span class="btn-icon">‚úÖ</span>
                                Validar
                            </button>
                        </div>
                        <div class="query-results" id="query-results"></div>
                    </div>
                </div>
            </div>

            <!-- Procedures Tab -->
            <div id="procedures-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2>‚öôÔ∏è Procedimientos Almacenados</h2>
                    </div>
                    <div class="card-body">
                        <div class="procedure-section">
                            <div class="form-group">
                                <label for="procedure-name">Nombre del procedimiento:</label>
                                <input type="text" id="procedure-name" class="form-control" placeholder="Ej: MI_SCHEMA.MI_PROCEDIMIENTO">
                            </div>
                            <div class="form-group">
                                <label for="procedure-params">Par√°metros (JSON):</label>
                                <textarea id="procedure-params" class="form-control" placeholder='{"param1": "valor1", "param2": "valor2"}'></textarea>
                            </div>
                            <div class="procedure-actions">
                                <button class="btn btn-primary" id="execute-procedure-btn">
                                    <span class="btn-icon">‚ñ∂Ô∏è</span>
                                    Ejecutar
                                </button>
                                <button class="btn btn-outline" id="get-procedure-info-btn">
                                    <span class="btn-icon">‚ÑπÔ∏è</span>
                                    Informaci√≥n
                                </button>
                            </div>
                        </div>
                        <div class="procedure-results" id="procedure-results"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <div class="status-bar" id="status-bar">
            <div class="status-item">
                <span class="status-label">Estado:</span>
                <span class="status-value" id="connection-status">Conectado</span>
            </div>
            <div class="status-item">
                <span class="status-label">Servidor:</span>
                <span class="status-value" id="server-url">http://localhost:8000</span>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Cargando...</div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
