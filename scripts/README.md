# üîß Generador de Configuraci√≥n de Entidades Oracle

Este directorio contiene herramientas para generar autom√°ticamente la configuraci√≥n JSON necesaria para el archivo `entities.json` analizando tablas de Oracle.

## üéØ Caracter√≠sticas

- ‚úÖ **Conexi√≥n autom√°tica a Oracle** con soporte para Instant Client
- ‚úÖ **An√°lisis autom√°tico de estructura** de tabla (columnas, tipos, constraints)
- ‚úÖ **Detecci√≥n autom√°tica de clave primaria** y auto-increment
- ‚úÖ **Mapeo de tipos Oracle** a tipos gen√©ricos del sistema
- ‚úÖ **Generaci√≥n de campos searchable** para tipos VARCHAR2
- ‚úÖ **Soporte para esquemas** (ej: WORKFLOW.TABLA)
- ‚úÖ **Interfaz de l√≠nea de comandos** amigable con PowerShell
- ‚úÖ **Guardado autom√°tico** en archivo o integraci√≥n con entities.json

## üìã Prerrequisitos

1. **Deno** instalado y en el PATH
2. **Oracle Instant Client** instalado y configurado
3. **Archivo .env** con configuraci√≥n de Oracle
4. **Permisos** de lectura en las vistas ALL_TABLES, ALL_TAB_COLUMNS, etc.

## ‚öôÔ∏è Configuraci√≥n

Aseg√∫rate de tener configuradas las siguientes variables en tu archivo `.env`:

```env
USER=tu_usuario_oracle
PASSWORD=tu_contrase√±a
CONNECTIONSTRING=host:puerto/servicio
LIB_ORA=C:\instantclient_21_10
```

## üöÄ Uso

### Uso b√°sico (PowerShell)

```powershell
# Generar configuraci√≥n para una tabla
.\generate-entity.ps1 -Tabla "WORKFLOW.PROC_CAB"

# Generar con nombre de entidad espec√≠fico
.\generate-entity.ps1 -Tabla "WORKFLOW.ADIFDO" -Entidad "adifdo"

# Guardar en archivo espec√≠fico
.\generate-entity.ps1 -Tabla "USUARIOS" -Archivo "usuarios-config.json"

# Agregar autom√°ticamente al archivo entities.json
.\generate-entity.ps1 -Tabla "USUARIOS" -Agregar
```

### Uso directo (Deno)

```bash
# Generar configuraci√≥n b√°sica
deno run --allow-all scripts/generate-entity-config.ts "WORKFLOW.PROC_CAB"

# Generar con nombre de entidad espec√≠fico
deno run --allow-all scripts/generate-entity-config.ts "WORKFLOW.ADIFDO" "adifdo"

# Modo silencioso (solo salida JSON)
deno run --allow-all scripts/generate-entity-config.ts "USUARIOS" --silent
```

## üì§ Salida

El script genera una configuraci√≥n JSON completa que incluye:

```json
{
  "nombre_entidad": {
    "tableName": "ESQUEMA.TABLA",
    "primaryKey": "ID_CAMPO",
    "autoIncrement": false,
    "displayName": "Nombre Entidad",
    "description": "Tabla ESQUEMA.TABLA",
    "fields": {
      "CAMPO1": {
        "type": "NUMBER",
        "required": true,
        "displayName": "Campo 1",
        "description": "Campo Campo 1",
        "searchable": false,
        "primaryKey": true,
        "readonly": true
      },
      "CAMPO2": {
        "type": "VARCHAR2",
        "required": false,
        "displayName": "Campo 2",
        "description": "Campo Campo 2",
        "searchable": true,
        "length": 100
      }
    }
  }
}
```

## üóÇÔ∏è Tipos soportados

El script mapea autom√°ticamente los tipos de Oracle a tipos gen√©ricos del sistema:

| Tipo Oracle | Tipo Gen√©rico | Observaciones |
|-------------|---------------|---------------|
| NUMBER (escala=0, precisi√≥n‚â§10) | INTEGER | N√∫meros enteros |
| NUMBER (otros) | NUMBER | N√∫meros decimales |
| VARCHAR2, CHAR, NVARCHAR2, NCHAR | VARCHAR2 | Cadenas de texto |
| DATE | DATE | Fechas |
| TIMESTAMP | TIMESTAMP | Fechas con hora |
| CLOB, NCLOB | CLOB | Texto largo |
| BLOB | BLOB | Datos binarios |
| RAW | RAW | Datos binarios raw |

## üîç Caracter√≠sticas detectadas autom√°ticamente

- **Clave primaria**: Se detecta autom√°ticamente desde constraints
- **Campos requeridos**: Basado en columnas NOT NULL
- **Campos searchable**: Autom√°ticamente para tipos VARCHAR2
- **Longitud de campos**: Para tipos VARCHAR2
- **Precisi√≥n y escala**: Para tipos NUMBER
- **Valores por defecto**: Se extraen de la definici√≥n de la tabla
- **Auto-increment**: Se detecta buscando triggers con secuencias

## üí° Ejemplos de uso com√∫n

### Generar configuraci√≥n para tabla de usuarios

```powershell
.\generate-entity.ps1 -Tabla "SISTEMA.USUARIOS" -Entidad "usuarios"
```

### Generar m√∫ltiples configuraciones

```powershell
# Generar configuraciones para m√∫ltiples tablas
$tablas = @("SISTEMA.USUARIOS", "SISTEMA.PERFILES", "SISTEMA.PERMISOS")
foreach ($tabla in $tablas) {
    $entidad = $tabla.Split('.')[1].ToLower()
    .\generate-entity.ps1 -Tabla $tabla -Entidad $entidad -Archivo "$entidad-config.json"
}
```

### Integraci√≥n con entities.json

```powershell
# Agregar autom√°ticamente al archivo entities.json
.\generate-entity.ps1 -Tabla "SISTEMA.USUARIOS" -Agregar
```

## üîß Soluci√≥n de problemas

### Error: "Tabla no existe o no es accesible"

1. Verifica que el nombre de la tabla sea correcto
2. Aseg√∫rate de incluir el esquema si es necesario
3. Confirma que el usuario tiene permisos de lectura en la tabla

### Error: "Faltan variables de entorno Oracle"

1. Verifica que el archivo `.env` existe
2. Confirma que las variables USER, PASSWORD, y CONNECTIONSTRING est√°n definidas
3. Revisa que no haya espacios extra en las l√≠neas del archivo `.env`

### Error: "connections to this database server version are not supported"

1. Verifica que Oracle Instant Client est√© instalado correctamente
2. Confirma que la variable LIB_ORA apunte al directorio correcto
3. Aseg√∫rate de que la versi√≥n de Instant Client sea compatible con tu Oracle Server

## üìÅ Archivos del proyecto

- `scripts/generate-entity-config.ts`: Script principal en TypeScript
- `generate-entity.ps1`: Wrapper PowerShell multiplataforma
- `generate-entity.sh`: Wrapper Bash para Linux/macOS
- `config/entities.json`: Archivo de configuraci√≥n principal

## ü§ù Contribuir

Para contribuir al proyecto:

1. Crea un fork del repositorio
2. Realiza tus cambios en una rama nueva
3. Ejecuta las pruebas: `deno test`
4. Formatea el c√≥digo: `deno fmt`
5. Env√≠a un pull request

## üìÑ Licencia

Este proyecto est√° bajo la misma licencia que el proyecto DNO-Oracle.
- **Integraci√≥n directa** con el archivo `entities.json`

## üìã Prerequisitos

- [Deno](https://deno.land/) instalado
- Archivo `.env` configurado con credenciales de Oracle
- Conexi√≥n a la base de datos Oracle

## üöÄ Uso

### Windows (PowerShell)

```powershell
# Uso b√°sico
.\generate-entity.ps1 -Tabla "USUARIOS"

# Con nombre de entidad personalizado
.\generate-entity.ps1 -Tabla "WORKFLOW.PROC_CAB" -Entidad "proc_cab"

# Guardar en archivo
.\generate-entity.ps1 -Tabla "SYSTEM_LOGS" -Archivo "logs-config.json"

# Agregar autom√°ticamente a entities.json
.\generate-entity.ps1 -Tabla "USUARIOS" -Agregar

# Ver ayuda
.\generate-entity.ps1 -Ayuda
```

### Linux/macOS (Bash)

```bash
# Hacer ejecutable (solo la primera vez)
chmod +x generate-entity.sh

# Uso b√°sico
./generate-entity.sh -t "USUARIOS"

# Con nombre de entidad personalizado
./generate-entity.sh -t "WORKFLOW.PROC_CAB" -e "proc_cab"

# Guardar en archivo
./generate-entity.sh -t "SYSTEM_LOGS" -f "logs-config.json"

# Agregar autom√°ticamente a entities.json
./generate-entity.sh -t "USUARIOS" -a

# Ver ayuda
./generate-entity.sh -h
```

### Uso directo con Deno

```bash
# Generar configuraci√≥n para una tabla
deno run --allow-net --allow-read --allow-env --allow-sys scripts/generate-entity-config.ts USUARIOS

# Con nombre de entidad personalizado
deno run --allow-net --allow-read --allow-env --allow-sys scripts/generate-entity-config.ts WORKFLOW.PROC_CAB proc_cab
```

## üõ†Ô∏è Funcionalidades del Generador

### An√°lisis Autom√°tico

El generador analiza autom√°ticamente:

- **Estructura de columnas**: tipos, longitudes, precisi√≥n
- **Constraints**: primary keys, unique constraints, nullability
- **Comentarios**: de tabla y columnas
- **√çndices**: para determinar campos searchable
- **Triggers**: para detectar auto-increment
- **Patrones comunes**: campos de estado, fechas, emails

### Generaci√≥n Inteligente

Genera autom√°ticamente:

- **Configuraci√≥n de campos** con tipos apropiados
- **Validaciones** basadas en constraints
- **Filtros comunes** (activos/inactivos, recientes)
- **Acciones personalizadas** (activar/desactivar, toggle)
- **Operaciones CRUD** est√°ndar

### Detecci√≥n de Patrones

Reconoce patrones comunes:

- **Campos de estado**: `IS_ACTIVE`, `ACTIVO`, `MOSTRAR`, `STATUS`
- **Campos de email**: genera validaci√≥n autom√°tica
- **Campos de auditor√≠a**: `CREATED_AT`, `UPDATED_AT`
- **Campos auto-increment**: detecta secuencias y triggers

## üìä Ejemplo de Salida

Para una tabla `USUARIOS` con columnas b√°sicas:

```json
{
  "usuarios": {
    "tableName": "USUARIOS",
    "primaryKey": "USER_ID",
    "autoIncrement": true,
    "displayName": "Usuarios",
    "description": "Tabla de usuarios del sistema",
    "fields": {
      "USER_ID": {
        "type": "NUMBER",
        "required": true,
        "primaryKey": true,
        "autoIncrement": true,
        "displayName": "ID Usuario",
        "description": "Identificador √∫nico del usuario",
        "readonly": true
      },
      "USERNAME": {
        "type": "VARCHAR2",
        "length": 50,
        "required": true,
        "unique": true,
        "displayName": "Nombre de usuario",
        "description": "Nombre √∫nico de usuario",
        "searchable": true
      },
      "EMAIL": {
        "type": "VARCHAR2",
        "length": 100,
        "required": true,
        "unique": true,
        "displayName": "Email",
        "description": "Correo electr√≥nico del usuario",
        "searchable": true,
        "format": "email"
      }
    },
    "operations": {
      "create": true,
      "read": true,
      "update": true,
      "delete": true,
      "search": true,
      "paginate": true
    },
    "filters": {
      "active": {
        "field": "IS_ACTIVE",
        "operator": "=",
        "value": 1,
        "displayName": "Solo activos"
      }
    },
    "validations": {
      "USERNAME": {
        "required": true,
        "maxLength": 50,
        "message": "Validaci√≥n para Nombre de usuario"
      },
      "EMAIL": {
        "required": true,
        "maxLength": 100,
        "format": "email",
        "message": "Validaci√≥n para Email"
      }
    },
    "customActions": {
      "activate": {
        "type": "UPDATE",
        "sql": "UPDATE USUARIOS SET IS_ACTIVE = 1 WHERE USER_ID = :id",
        "displayName": "Activar",
        "description": "Activa el registro"
      }
    }
  }
}
```

## üìù Personalizaci√≥n

Despu√©s de generar la configuraci√≥n, puedes personalizarla:

1. **Ajustar nombres de display**
2. **A√±adir/modificar validaciones**
3. **Configurar filtros espec√≠ficos**
4. **Crear acciones personalizadas**
5. **Ajustar operaciones permitidas**

## üîß Archivos Incluidos

- **`scripts/generate-entity-config.ts`**: Script principal en TypeScript
- **`generate-entity.ps1`**: Wrapper para Windows PowerShell
- **`generate-entity.sh`**: Wrapper para Linux/macOS Bash
- **`README.md`**: Esta documentaci√≥n

## üé≠ Troubleshooting

### Error: "Deno no encontrado"
```bash
# Instalar Deno
curl -fsSL https://deno.land/install.sh | sh
```

### Error: "Archivo .env no encontrado"
```bash
# Crear archivo .env con configuraci√≥n Oracle
echo "USER=tu_usuario" > .env
echo "PASSWORD=tu_password" >> .env
echo "CONNECTIONSTRING=localhost:1521/XE" >> .env
echo "LIB_ORA=C:/oracle/instantclient_19_8" >> .env
```

### Error: "Tabla no encontrada"
- Verifica que la tabla existe
- Aseg√∫rate de tener permisos de lectura
- Usa el nombre completo con schema si es necesario

## ü§ù Contribuir

Si encuentras bugs o quieres agregar funcionalidades:

1. Crea un issue describiendo el problema/mejora
2. Haz un fork del repositorio
3. Implementa los cambios
4. Env√≠a un pull request

## üìÑ Licencia

Este proyecto est√° bajo la licencia MIT. Ver archivo `LICENSE` para m√°s detalles.

---

üí° **Tip**: Siempre revisa y personaliza la configuraci√≥n generada antes de usarla en producci√≥n.
